name: CI â€” Functional Tests

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}
  schedule:
    # Nightly at 03:00 UTC
    - cron: '0 3 * * *'

permissions:
  contents: read

jobs:
  functional:
    name: Functional Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (fetch LFS objects)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ensure Git LFS objects are present
        run: |
          git lfs install --local || true
          git lfs pull || true

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.10'

      - name: Install Poetry
        uses: snok/install-poetry@v1
        with:
          version: latest
          virtualenvs-create: true
          virtualenvs-in-project: true

      - name: Install dependencies
        run: poetry install --with dev --no-interaction --no-ansi

      - name: Run functional tests
        run: poetry run pytest -q -m functional
